<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fatigue Crack Detection Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/"
        }
      }
    </script>
  </head>

  <body>
    <div class="sidebar collapsed" id="sidebar">
      <button id="sidebarToggle" class="hamburger">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
      <img
        src="{{ url_for('static', filename='images/lrmc_vert.png') }}"
        class="logo"
        alt="LRMC Logo"
      />
      <nav>
        <ul>
          <li class="nav-tab active" id="dashboardTab" data-view="dashboard">Dashboard</li>
          <li class="nav-tab" id="historyTab" data-view="history">History</li>
          <li class="nav-tab" id="liveFeedTab" data-view="livefeed">Live Feed</li>
        </ul>
      </nav>
    </div>

    <div class="main-content" id="mainContent">
      <div id="dashboardView">
        <div class="top-tabs">
          <div class="tab-btn active" id="imageTab" data-content="image">
            <b>Image</b>
            <input type="file" id="imageInput" accept="image/*" hidden />
            <button id="uploadBtn">Upload</button>
          </div>
          <div class="tab-btn" id="modelTab" data-content="model"><b>3D Model</b></div>
        </div>

        <div class="viewer-area" id="viewerArea">
          <div id="imageContainer" class="drop-zone" style="display: flex;">
            <p class="drop-text">Drag an image here or click Upload</p>
            <img id="uploadedImage" src="#" alt="Uploaded" style="display: none;" />
          </div>
          <canvas id="viewer" style="display: none;"></canvas>
        </div>

        <div class="info-section">
          <div class="info-box">
            <h3>Bogie Information</h3>
            <p><b>ID:</b> <span id="bogieId">--</span></p>
            <p><b>Status:</b> <span id="status">--</span></p>
            <p><b>Time:</b> <span id="timestamp">--</span></p>
          </div>

          <div class="info-box scrollable">
            <h3>Detected Cracks</h3>
            <ul id="detectionsList"></ul>
          </div>

          <div class="info-box">
            <h3>Recommendation</h3>
            <p id="recommendation">--</p>
          </div>
        </div>
      </div>

      <div id="historyView" style="display: none;"></div>

      <div id="liveFeedView" style="display: none; text-align: center;">
        <h2>Live Camera Feed</h2>
        <div class="live-feed-container">
          <img
            id="liveFeed"
            src="/video_feed"
            alt="Live Feed"
            style="
              max-width: 90%;
              border: 3px solid #214390;
              border-radius: 8px;
            "
          />
          <p id="liveFeedStatus">Click the Live Feed tab to start the stream...</p>
        </div>
      </div>
    </div>

    <div id="imagePreviewOverlay">
      <div class="preview-content">
        <img id="previewImage" src="#" alt="Preview" />
        <p id="previewFilename"></p>
        <span id="closePreview">&times;</span>
      </div>
    </div>

    <script
      type="module"
      src="{{ url_for('static', filename='js/viewer.js') }}"
    ></script>
    <script
      src="{{ url_for('static', filename='js/sidebar.js') }}"
    ></script>
    <script
      type="module"
      src="{{ url_for('static', filename='js/dashboard.js') }}"
    ></script>
    <script
      type="module"
      src="{{ url_for('static', filename='js/history.js') }}"
    ></script>
    <script
      type="module"
      src="{{ url_for('static', filename='js/livefeed.js') }}"
    ></script>
  </body>
</html>